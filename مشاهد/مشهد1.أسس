
//متغيرات عامة

عرف ألعاب: مـصفوفة[مـلصق]؛
عرف العاب_س: مـصفوفة[صحيح]({
    61*4،
    100*4،
    164*4،
    178*4،
    249*4
})؛
عرف العاب_ص: مـصفوفة[صحيح]({
    78*4،
    76*4،
    67*4،
    55*4،
    59*4
})؛

    
عرف صوت_الالعاب: صـوت؛
عرف صأدنى: مصفوفة[صحيح، 6]؛

عرف فراشة: مـصفوفة[مـلصق]؛
عرف فراشة_س: مصفوفة[صحيح، 2]؛
عرف فراشة_ص: مصفوفة[صحيح، 2]؛
عرف سدر: مـصفوفة[صحيح]({1، 1})؛
    
دالة في_حفل_الزواج (): ثـنائي {
    القائمة_العائمة.مكن_التجاوز()؛
    عرف مشهد:مـشهد؛
    عرف وجه_الصفر:مـلصق؛
    انتظر(مـؤجلات.مـؤجلة[صـحيح].الكل({
        صوت_الالعاب.هيئ(نـص("أصوات/مشهد1/في_حفل_الزواج/ألعاب_نارية.wav"))،
        مشهد.حمل_خلفية(نـص("رسوم/مشهد1/في_حفل_الزواج/مدينة1.png")، 4)،
        وجه_الصفر.هيئ(نـص("رسوم/مشهد1/في_حفل_الزواج/وجه_الصفر11")، 4، 20*4، 92*4)
    }).تجاهل_النتيجة())؛

    ألعاب = انتظر[مـصفوفة[مـلصق]](مـؤجلات.مـؤجلة[مـلصق].الكل({
        حمل_ملصقا(نـص("رسوم/مشهد1/في_حفل_الزواج/BOMB1")، 1)،
        حمل_ملصقا(نـص("رسوم/مشهد1/في_حفل_الزواج/BOMB2")، 1)،
        حمل_ملصقا(نـص("رسوم/مشهد1/في_حفل_الزواج/BOMB3")، 1)،
        حمل_ملصقا(نـص("رسوم/مشهد1/في_حفل_الزواج/BOMB1")، 1)،
        حمل_ملصقا(نـص("رسوم/مشهد1/في_حفل_الزواج/BOMB2")، 1)،
        حمل_ملصقا(نـص("رسوم/مشهد1/في_حفل_الزواج/BOMB3")، 1)
    }))؛
    
    مشهد.أضف_ملصقات({وجه_الصفر})؛
    
    عرف ه:صحيح؛
    عرف ت:صحيح؛
    عرف س:صحيح؛
    عرف ص:صحيح؛
   
    //تجهيز الأماكن
    لكل ه=0، ه<6، ه++ {
        ت = 3 + ريـاضيات.عشوائي() % 4؛
        ألعاب(ه).نقش.طول *= ت؛ ألعاب(ه).نقش.عرض *= ت؛
        مشهد.أضف_ملصقات({ ألعاب(ه) })؛
        ت = ريـاضيات.عشوائي() % 5؛
        س = العاب_س(ت)؛
        ص = ريـاضيات.عشوائي() % العاب_ص(ت)؛
        ألعاب(ه).ضع(س، ص)؛
        صأدنى(ه) = ريـاضيات.عشوائي() % 20؛
    }؛
   
    عرف الوقت_السابق: صحيح[64] = هات_الختم_الزمني_بالملي()؛

    مشهد.تحديث = مغلفة (الوقت_السابق: كسند)&() {
        عرف الآن: صحيح[64] = هات_الختم_الزمني_بالملي()؛
        إذا الآن - الوقت_السابق > 100 {
            تفعيل_الألعاب()؛
            الوقت_السابق = الآن؛
        }
    }؛

    أظهر_رويدا(مشهد، 1000)؛
    تمهل(1000)؛

   اعرض_محادثة(مشهد، مـصفوفة_كلام({
        كـلام(
            "أصوات/مشهد1/في_حفل_الزواج/الراوي1-1.wav"،
            نـص("يُقام الليلة حفل زواج الأمير زياد، أمير الجمع،\ج"
            "من الأميرة نقصان، أميرة الطرح.")،
            _عرض_النافذة_، 0، 1000
        )،
        كـلام(
            "أصوات/مشهد1/في_حفل_الزواج/صفر1-1.wav"،
            نـص("لماذا لم يدعوني إلى الحفلة؟\ج"
            "كيف يجرؤون؟ سوف\ج"
            "يندمون على ذلك.")،
            53*4، 91*4، 30*4، 30، وجه_الصفر، 0، -1، 200
        )
    }))؛

    تمهل_مع_تمكين_التجاوز_والعودة[3000]؛
    أخف_رويدا(مشهد، 1000)؛
    ارجع 1؛
}؛

دالة على_الطريق11 (): ثـنائي {
    القائمة_العائمة.مكن_التجاوز()؛
    //التعريفات
    عرف مشهد:مـشهد؛
    عرف وجه_الصفر:مـلصق؛
    عرف وجه_زياد:مـلصق؛
    عرف الطريق1:مـلصق؛
    عرف الطريق2:مـلصق؛
    عرف خلف:مـلصق؛

    انتظر(مـؤجلات.مـؤجلة[صـحيح].الكل({
        مشهد.حمل_خلفية(نـص("رسوم/مشهد1/على_الطريق11/طريق11.png")، 4)،
        وجه_الصفر.هيئ(نـص("رسوم/مشهد1/على_الطريق11/صفر10")، 4، 110*4، 120*4)،
        وجه_زياد.هيئ(نـص("رسوم/مشهد1/على_الطريق11/الأمير10")، 4، 168*4، 95*4)،
        الطريق1.هيئ(نـص("رسوم/مشهد1/على_الطريق11/طريق11أ")، 4، 92*4، 90*4)،
        الطريق2.هيئ(نـص("رسوم/مشهد1/على_الطريق11/طريق11ب")، 4، 92*4، 90*4)،
        خلف.هيئ(نـص("رسوم/مشهد1/على_الطريق11/خلف10")، 4، 164*4، 90*4)
    }).تجاهل_النتيجة())؛

    أظهر_رويدا(مشهد، 1000)؛
    //الحوار1
    اعرض_محادثة(مشهد، مـصفوفة_كلام({
        كـلام(
            "أصوات/مشهد1/على_الطريق11/صفر1-2.wav"،
            نـص("هذه هي فرصتي للانتقام. سوف\ج"
            "أهديهم هذا التفاح المسموم.")،
            140*4، 114*4، 30*4، 80، 1، 200
        )
    }))؛
    تحقق_من_التجاوز_والعودة[]؛

    //المشي
    مشهد.أضف_ملصق(خلف)؛
    مشهد.أضف_ملصق(الطريق1)؛
    تمهل_مع_تمكين_التجاوز_والعودة[1500]؛
    مشهد.أضف_ملصق(الطريق2)؛
    تمهل_مع_تمكين_التجاوز_والعودة[1500]؛
    
    //الحوار2
    مشهد.أضف_ملصقات({وجه_الصفر، وجه_زياد})؛
    وجه_زياد.الحالي = -1؛
    اعرض_محادثة(مشهد، مـصفوفة_كلام({
        كـلام(
            "أصوات/مشهد1/على_الطريق11/صفر1-3.wav"،
            نـص("مرحبًا أيها الأمير.\n"
            "مرحبًا يا أميرة.")،
            140*4، 114*4، 30*4، 80، وجه_الصفر، 0، 1، 200
            )،
        كـلام(
            "أصوات/مشهد1/على_الطريق11/زياد1-1.wav"،
            نـص("ماذا تفعل هنا أيها الشرير؟")،
            170*4، 96*4، 30*4، 120، وجه_زياد، 0، -1، 200
        )،
        كـلام(
            "أصوات/مشهد1/على_الطريق11/صفر1-4.wav"،
            نـص("أنا لم أعد شريرًا الآن،\n"
            "فقد قررت إصلاح جميع \n"
            "أخطائي الماضية.")،
            140*4، 114*4، 30*4، 80، وجه_الصفر، 0، 1، 200
            )،
        كـلام(
            "أصوات/مشهد1/على_الطريق11/زياد1-2.wav"،
            نـص("هم... أرجو أن تكون\n"
            "صادقًا هذه المرة.")،
            170*4، 96*4، 30*4، 120، وجه_زياد، 0، -1، 200
        )،
        كـلام(
            "أصوات/مشهد1/على_الطريق11/صفر1-5.wav"،
            نـص("أرجو أن تقبلوا هذا التفاح\n"
            "كهدية بمناسبة الزواج.")،
            140*4، 114*4، 30*4، 80، وجه_الصفر، 2، 3، 200
        )،      
    }))؛
    تحقق_من_التجاوز_والعودة[]؛
    أخف_رويدا(مشهد، 1000)؛
    أرجع 1؛
}؛

دالة في_القصر1 (): ثـنائي {
    القائمة_العائمة.مكن_التجاوز()؛
    //التعريفات
    عرف مشهد:مـشهد؛
    عرف خلفية: مـلصق؛
    عرف الطبيب:مـلصق؛
    عرف ملك_الجمع:مـلصق؛
    عرف ملك_الطرح:مـلصق؛
    عرف الواحد:مـلصق؛

    انتظر(مـؤجلات.مـؤجلة[صـحيح].الكل({
        خلفية.هيئ(نـص("رسوم/مشهد1/في_القصر11/قصر_الملك")، 4، 0، 0)،
        الطبيب.هيئ(نـص("رسوم/مشهد1/في_القصر11/الطبيب11")، 4، 171*4، 100*4)،
        ملك_الجمع.هيئ(نـص("رسوم/مشهد1/في_القصر11/ملك_الجمع")، 4، 262*4، 103*4)،
        ملك_الطرح.هيئ(نـص("رسوم/مشهد1/في_القصر11/ملك_الطرح")، 4، 214*4، 79*4)،
        الواحد.هيئ(نـص("رسوم/مشهد1/في_القصر11/وجه_الواحد10")، 4، 91*4، 140*4)
    }).تجاهل_النتيجة())؛

    مشهد.أضف_ملصقات({خلفية، الواحد، ملك_الجمع، ملك_الطرح})؛
    
    أظهر_رويدا(مشهد، 1000)؛
    //الحوار
    اعرض_محادثة(مشهد، مـصفوفة_كلام({
        كـلام(
            "أصوات/مشهد1/في_القصر11/BOBO1-1.mp3"،
            نـص("ماذا حدث يا\n"
            "صاحب الجلالة؟",)،
            137*4، 114*4، 30*4، 80، 200
            )،
        كـلام(
            "أصوات/مشهد1/في_القصر11/KINGP1-1.WAV"،
            نـص("إنه الصفر اللعين،\n"
            "لقد سمم ولدي الوحيد\n"
            "وأميرته الجميلة.")،
            268*4، 104*4، 30*4، 150، ملك_الجمع، 0، -1، 200
        )،
        كـلام(
            "أصوات/مشهد1/في_القصر11/BOBO1-2.mp3"،
            نـص("يا إلهي. هل\n"
            "هما بخير؟")،
            137*4، 114*4، 30*4، 80، 200
        )،
        كـلام(
            "أصوات/مشهد1/في_القصر11/KINGN1-1.WAV"،
            نـص("إن الحكيم يفحصهما الآن.")،
            209*4، 86*4، 30*4، 160، ملك_الطرح، 0، -1، 200
        )،      
    }))؛
    
    تمهل_مع_تمكين_التجاوز_والعودة[1000]؛
    خلفية.الحالي = 1؛
    مشهد.أضف_ملصق(الطبيب)؛
    مشهد.أزل_ملصق(ملك_الطرح)؛
    تمهل_مع_تمكين_التجاوز_والعودة[500]؛
    //الحوار
    اعرض_محادثة(مشهد، مـصفوفة_كلام({
        كـلام(
            "أصوات/مشهد1/في_القصر11/DOC1-1.WAV"،
            نـص("يؤسفني ان أخبركم\n"
            "أن حالتهما خطيرة.")،
            176*4، 90*4، 30*4، 100،الطبيب، 0، -1، 200
            )،
        كـلام(
            "أصوات/مشهد1/في_القصر11/KINGP1-2.WAV"،
            نـص("ألا يوجد دواء يشفيهما؟")،
            268*4، 104*4، 30*4، 150، ملك_الجمع، 0، -1، 200
        )،
        كـلام(
            "أصوات/مشهد1/في_القصر11/DOC1-2.WAV"،
            نـص("هنالك دواء واحد يستخرج\n"
            "من زهرة الشفاء السحرية.")،
            176*4، 90*4، 30*4، 100،الطبيب، 0، -1، 200
        )،
        كـلام(
            "أصوات/مشهد1/في_القصر11/ONE1-1.WAV"،
            نـص("لا تقلقوا، سوف نحضرها لكم.")،
            100*4، 122*4، 30*4، 80، الواحد، 0، -1، 200
        )،      
    }))؛
    تحقق_من_التجاوز_والعودة[]؛
    أخف_رويدا(مشهد، 1000)؛
    أرجع 1؛
}؛

//دالات العمل

دالة تفعيل_الألعاب () {
    عرف ه:صحيح؛
    عرف ت:صحيح؛
    
    لكل ه=0، ه<6، ه++ {
        إذا ألعاب(ه).ص<= صأدنى(ه) {
            إذا ألعاب(ه).الحالي==1 {
                صوت_الالعاب.شغل(0)؛
            }
            إذا ألعاب(ه).الحالي==5 {
                ت=ريـاضيات.عشوائي() % 5؛
                ألعاب(ه).ضع(العاب_س(ت)، العاب_ص(ت))؛
                ألعاب(ه).الحالي=0؛
                صأدنى(ه)=ريـاضيات.عشوائي() % 20؛
            } وإلا {
                ألعاب(ه).الحالي=ألعاب(ه).الحالي+1؛
            }؛
        } وإلا {
            ألعاب(ه).ضع(ألعاب(ه).س، ألعاب(ه).ص-10)؛
        }؛
    }؛
}؛

دالة حرك_الفراشة () {   
    عرف ه:صحيح؛
    عرف ن:صحيح؛
    
    إذا فراشة_س(0)>-20*4 {
        ن=(ريـاضيات.عشوائي() % 7-3)*4؛
        فراشة_ص(0)+=ن؛
        إذا فراشة_ص(0)>100*4 أو فراشة_ص(0)<0 {
            فراشة_ص(0)-=2*ن؛
        }؛
        فراشة_س(0)-=3*4؛
    } وإلا {
        فراشة_س(0)=320*4؛
        فراشة_ص(0)=(ريـاضيات.عشوائي() % 100)*4؛
    }؛
    ن=(ريـاضيات.عشوائي() % 5-2)*4؛
    فراشة_س(1)+=ن؛
    إذا فراشة_س(1)<0 أو فراشة_س(1)>50*4 {
        فراشة_س(1)-=2*ن؛
    }؛
    ن=(ريـاضيات.عشوائي() % 5-2)*4؛
    فراشة_ص(1)+=ن؛
    إذا فراشة_ص(1)<80*4 أو فراشة_ص(1)>120*4{
        فراشة_ص(1)-=2*ن؛
    }؛ 
    
    لكل ه=0، ه<2، ه++ {
        عرف حالة: صـحيح = فراشة(ه).الحالي + سدر(ه)؛
        إذا (حالة==0 و سدر(ه)==-1) أو (حالة==فراشة(ه).عدد_الحالات-1 و سدر(ه)==1) {
            سدر(ه) = سدر(ه) * -1؛
        }
        فراشة(ه).ضع(فراشة_س(ه)، فراشة_ص(ه))؛
        فراشة(ه).الحالي = حالة؛
    }؛
}؛

دالة حرك_السحر(الأرقام2: سند[مـلصق]) {
    @مشترك عرف ه: صحيح(0)؛
    ++ه؛
    إذا ه == 2 {
        الأرقام2.شفافية = 0؛
    } وإلا إذا ه == 4 {
        الأرقام2.شفافية = 255؛
        ه = 0؛
    }
}
