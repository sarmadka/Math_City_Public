صنف الـصفحة_الرئيسية {
    @حقنة عرف مركب: مـركب؛

    // المتغيرات
    عرف زر_التنصيب: سـندنا[ارتـباط_تشعبي]؛
    عرف مؤجلة: سـندنا[مـؤجلات.مـؤجلة[صـحيح]] = مـؤجلات.مـؤجلة[صـحيح].أنشئ()؛
    عرف شاشة_عريضة: ثـنائي = 0؛
    عرف جديد: ثـنائي = 1؛

    عملية هذا~هيئ() {
        هذا.المشهد = صـندوق()؛
    }

    عملية هذا.أنشئ_المشهد_لشاشة_عريضة() {
        عرف الكائن: سند[هذا_الصنف](هذا)؛
        هذا.المشهد = صـندوق().{
            الطراز.{
                العرض = مـسافة.مئوي(100)؛
            }؛
            أضف_فروع({
                صـندوق().{
                    الطراز.{
                        الإظهار = إظـهار._مرن_؛
                        النسق = نـسق._عمود_؛
                        ملء_السطر = مـلء_سطر._بداية_؛
                        الطول = مـسافة.بكسلات(240)؛
                        الخلفية = خـلفية(نـص("/رسوم/سيف_صغيرة.png")، 0، 0، مـوقع_خلفية._يسار_، حـجم_خلفية._احتواء_)؛
                    }؛
                    أضف_فروع({
                        كـتابة().{
                            النص = نـص("سَيْف فِي مَدِينَةِ الرِّياضِيّات")؛
                            الطراز.{
                                فئة_الخط = "SayfFont"؛
                                لون_الخط = لـون("fff")؛
                                حجم_الخط = مـسافة.نقاط(60)؛
                                ظل_النص = ظـل_نص(مـسافة.نقاط(0)، مـسافة.نقاط(0)، مـسافة.نقاط(6)، لـون("F00"))؛
                                الهامش = مـسافة4.نقاط(30، 30)؛
                            }؛
                        }،
                        كـتابة().{
                            النص = نـص("لعبة لتعليم الرياضيات للأعمار 8 - 12 سنة")؛
                            الطراز.{
                                فئة_الخط = "SayfFont"؛
                                لون_الخط = لـون("ffffff")؛
                                ظل_النص = ظـل_نص(مـسافة.نقاط(0)، مـسافة.نقاط(0)، مـسافة.نقاط(6)، لـون("000"))؛
                                الهامش = مـسافة4.نقاط(30، 30)؛
                            }؛
                        }،
                    })؛
                }،
                صـندوق().{
                    الطراز.{
                        الإظهار = إظـهار._مرن_؛
                        النسق = نـسق._سطر_؛
                        المحاذاة = مـحاذاة._وسط_؛
                        ملء_السطر = مـلء_سطر._مسافة_محيطية_؛
                        الهامش = مـسافة4.نقاط(20)؛
                        نصف_قطر_الإطار = مـسافة4.نقاط(20)؛
                        الخلفية = خـلفية(لـون("101070E0"))؛
                    }؛
                    أضف_فروع({
                        كـتابة().{
                            الطراز.{
                                الهامش = مـسافة4.نقاط(20)؛
                                لون_الخط = لـون(255، 255، 255)؛
                            }؛
                            النص = نـص(
                                "لعبة لتعليم الرياضيات في إطار من المغامرة والتشويق وبأسلوب القصص المصورة."
                            )؛
                        }،
                        صـورة().{
                            الطراز.{
                                العرض = مـسافة.بكسلات(400)؛
                                الهامش = مـسافة4.نقاط(20)؛
                                أقصى_عرض = مـسافة.مئوي(100)؛
                            }؛
                            الرابط = نـص("/رسوم/CITY01.png")؛
                        }،
                    })؛
                }،
                صـندوق().{
                    الطراز.{
                        الإظهار = إظـهار._مرن_؛
                        النسق = نـسق._سطر_؛
                        المحاذاة = مـحاذاة._وسط_؛
                        ملء_السطر = مـلء_سطر._مسافة_محيطية_؛
                        الهامش = مـسافة4.نقاط(20)؛
                        نصف_قطر_الإطار = مـسافة4.نقاط(20)؛
                        الخلفية = خـلفية(لـون("055075E0"))؛
                    }؛
                    أضف_فروع({
                        صـورة().{
                            الطراز.{
                                العرض = مـسافة.بكسلات(400)؛
                                الهامش = مـسافة4.نقاط(20)؛
                                أقصى_عرض = مـسافة.مئوي(100)؛
                            }؛
                            الرابط = نـص("/رسوم/PALACE11.png")؛
                        }،
                        كـتابة().{
                            الطراز.{
                                الهامش = مـسافة4.نقاط(20)؛
                                لون_الخط = لـون(255، 255، 255)؛
                            }؛
                            النص = نـص(
                                "تقدم الرياضيات إلى الأطفال بأسلوب مشوق بعيد عن الرتابة وبجودة عالية وبلا إعلانات."
                            )؛
                        }،
                    })؛
                }،
                صـندوق().{
                    الطراز.{
                        الإظهار = إظـهار._مرن_؛
                        النسق = نـسق._سطر_؛
                        المحاذاة = مـحاذاة._وسط_؛
                        ملء_السطر = مـلء_سطر._مسافة_محيطية_؛
                        الهامش = مـسافة4.نقاط(20)؛
                        نصف_قطر_الإطار = مـسافة4.نقاط(20)؛
                        الخلفية = خـلفية(لـون("101070E0"))؛
                    }؛
                    أضف_فروع({
                        كـتابة().{
                            الطراز.{
                                الهامش = مـسافة4.نقاط(20)؛
                                لون_الخط = لـون(255، 255، 255)؛
                            }؛
                            النص = نـص(
                                "نسخة محسنة من اللعبة الأصلية الصادرة سنة 1997 على نظام ويندوز 3.1. "
                                "تحتفظ هذه النسخة بالرسوم والأصوات الأصلية مع بعض التحسينات."
                            )؛
                        }،
                        صـورة().{
                            الطراز.{
                                العرض = مـسافة.بكسلات(400)؛
                                الهامش = مـسافة4.نقاط(20)؛
                                أقصى_عرض = مـسافة.مئوي(100)؛
                            }؛
                            الرابط = نـص("/رسوم/ROAD.png")؛
                        }،
                    })؛
                }،
                صـندوق().{
                    الطراز.{
                        الإظهار = إظـهار._مرن_؛
                        النسق = نـسق._سطر_؛
                        ملء_السطر = مـلء_سطر._مسافة_محيطية_؛
                    }؛
                    أضف_فروع({
                        الكائن.أنشئ_زر_التنصيب(50)،
                        الكائن.أنشئ_زر_البدء(50)
                    })؛
                }،
                صـندوق().{
                    الطراز.{
                        الإظهار = إظـهار._مرن_؛
                        النسق = نـسق._سطر_؛
                        ملء_السطر = مـلء_سطر._مسافة_محيطية_؛
                    }؛
                    أضف_فروع({
                        الكائن.أنشئ_زر_توجيه(
                            50،
                            نـص("أتواجه مشكلة أو عندك اقتراح أو استفسار؟")،
                            نـص("اتصل بنا")،
                            نـص("/contact")
                        )،
                        الكائن.أنشئ_زر_توجيه(
                            50،
                            نـص("نحترم خصوصيتك ولا نشارك بياناتك مع جهات خارجية.")،
                            نـص("سياسة الخصوصية")،
                            نـص("/privacy-policy/en")
                        )
                    })؛
                }،
            })؛
        }؛
    }

    عملية هذا.أنشئ_المشهد_لشاشة_رفيعة() {
        عرف الكائن: سند[هذا_الصنف](هذا)؛
        هذا.المشهد = صـندوق().{
            الطراز.{
                العرض = مـسافة.مئوي(100)؛
                الإظهار = إظـهار._مرن_؛
                النسق = نـسق._عمود_؛
                المحاذاة = مـحاذاة._وسط_؛
                حجم_الخط = مـسافة.عن(8)؛
            }؛
            أضف_فروع({
                صـندوق().{
                    الطراز.{
                        الإظهار = إظـهار._مرن_؛
                        النسق = نـسق._عمود_؛
                        ملء_السطر = مـلء_سطر._بداية_؛
                        الطول = مـسافة.عن(55)؛
                        العرض = مـسافة.مئوي(100)؛
                        الخلفية = خـلفية(نـص("/رسوم/سيف_صغيرة.png")، 0، 0، مـوقع_خلفية._يسار_، حـجم_خلفية._احتواء_)؛
                    }؛
                    أضف_فروع({
                        كـتابة().{
                            النص = نـص("سَيْف فِي\جمَدِينَةِ الرِّياضِيّات")؛
                            الطراز.{
                                فئة_الخط = "SayfFont"؛
                                لون_الخط = لـون("fff")؛
                                حجم_الخط = مـسافة.عن(13)؛
                                ارتفاع_الكتابة = مـسافة.عن(14)؛
                                ظل_النص = ظـل_نص(مـسافة.نقاط(0)، مـسافة.نقاط(0)، مـسافة.نقاط(6)، لـون("F00"))؛
                                الهامش = مـسافة4.عن(0، 3، 3، 0)؛
                            }؛
                        }،
                        كـتابة().{
                            النص = نـص("لعبة لتعليم الرياضيات\جللأعمار 8 - 12 سنة")؛
                            الطراز.{
                                فئة_الخط = "SayfFont"؛
                                لون_الخط = لـون("ffffff")؛
                                ارتفاع_الكتابة = مـسافة.عن(9)؛
                                الهامش = مـسافة4.عن(3، 3، 0، 0)؛
                            }؛
                        }،
                    })؛
                }،
                صـندوق().{
                    الطراز.{
                        الإظهار = إظـهار._مرن_؛
                        النسق = نـسق._عمود_؛
                        المحاذاة = مـحاذاة._وسط_؛
                        الهامش = مـسافة4.نقاط(10)؛
                        نصف_قطر_الإطار = مـسافة4.نقاط(20)؛
                        الخلفية = خـلفية(لـون("101070E0"))؛
                    }؛
                    أضف_فروع({
                        كـتابة().{
                            الطراز.{
                                الهامش = مـسافة4.نقاط(10)؛
                                لون_الخط = لـون(255، 255، 255)؛
                            }؛
                            النص = نـص(
                                "لعبة لتعليم الرياضيات في إطار من المغامرة والتشويق وبأسلوب القصص المصورة."
                            )؛
                        }،
                    })؛
                }،
                صـورة().{
                    الطراز.{
                        العرض = مـسافة.بكسلات(400)؛
                        أقصى_عرض = مـسافة.مئوي(100)؛
                    }؛
                    الرابط = نـص("/رسوم/CITY01.png")؛
                }،
                صـندوق().{
                    الطراز.{
                        الإظهار = إظـهار._مرن_؛
                        النسق = نـسق._عمود_؛
                        المحاذاة = مـحاذاة._وسط_؛
                        الهامش = مـسافة4.نقاط(10)؛
                        نصف_قطر_الإطار = مـسافة4.نقاط(20)؛
                        الخلفية = خـلفية(لـون("055075E0"))؛
                    }؛
                    أضف_فروع({
                        كـتابة().{
                            الطراز.{
                                الهامش = مـسافة4.نقاط(10)؛
                                لون_الخط = لـون(255، 255، 255)؛
                            }؛
                            النص = نـص(
                                "تقدم الرياضيات إلى الأطفال بأسلوب مشوق بعيد عن الرتابة وبجودة عالية وبلا إعلانات."
                            )؛
                        }،
                    })؛
                }،
                صـورة().{
                    الطراز.{
                        العرض = مـسافة.بكسلات(400)؛
                        أقصى_عرض = مـسافة.مئوي(100)؛
                    }؛
                    الرابط = نـص("/رسوم/PALACE11.png")؛
                }،
                صـندوق().{
                    الطراز.{
                        الإظهار = إظـهار._مرن_؛
                        النسق = نـسق._عمود_؛
                        المحاذاة = مـحاذاة._وسط_؛
                        الهامش = مـسافة4.نقاط(10)؛
                        نصف_قطر_الإطار = مـسافة4.نقاط(20)؛
                        الخلفية = خـلفية(لـون("101070E0"))؛
                    }؛
                    أضف_فروع({
                        كـتابة().{
                            الطراز.{
                                الهامش = مـسافة4.نقاط(10)؛
                                لون_الخط = لـون(255، 255، 255)؛
                            }؛
                            النص = نـص(
                                "نسخة محسنة من اللعبة الأصلية الصادرة سنة 1997 على نظام ويندوز 3.1. "
                                "تحتفظ هذه النسخة بالرسوم والأصوات الأصلية مع بعض التحسينات."
                            )؛
                        }،
                    })؛
                }،
                صـورة().{
                    الطراز.{
                        العرض = مـسافة.بكسلات(400)؛
                        أقصى_عرض = مـسافة.مئوي(100)؛
                    }؛
                    الرابط = نـص("/رسوم/ROAD.png")؛
                }،
                صـندوق().{
                    الطراز.{
                        الإظهار = إظـهار._مرن_؛
                        النسق = نـسق._عمود_؛
                        ملء_السطر = مـلء_سطر._مسافة_محيطية_؛
                    }؛
                    أضف_فروع({
                        الكائن.أنشئ_زر_التنصيب(100)،
                        الكائن.أنشئ_زر_البدء(100)،
                        الكائن.أنشئ_زر_توجيه(
                            100،
                            نـص("أتواجه مشكلة أو عندك اقتراح أو استفسار؟")،
                            نـص("اتصل بنا")،
                            نـص("/contact")
                        )،
                        الكائن.أنشئ_زر_توجيه(
                            100،
                            نـص("نحترم خصوصيتك ولا نشارك بياناتك مع جهات خارجية.")،
                            نـص("سياسة الخصوصية")،
                            نـص("/privacy-policy/en")
                        )
                    })؛
                }،
            })؛
        }؛
    }

    عملية هذا.أنشئ_زر_التنصيب(عرض: صـحيح): سـندنا[صـندوق] {
        عرف الكائن: سند[هذا_الصنف](هذا)؛
        أرجع صـندوق().{
            الطراز.{
                الإظهار = إظـهار._مرن_؛
                النسق = نـسق._عمود_؛
                المحاذاة = مـحاذاة._وسط_؛
                ملء_السطر = مـلء_سطر._مسافة_بينية_؛
                العرض = مـسافة.مئوي(عرض) - مـسافة.نقاط(40)؛
                نصف_قطر_الإطار = مـسافة4.نقاط(20)؛
                الهامش = مـسافة4.نقاط(10)؛
                الحشوة = مـسافة4.نقاط(10)؛
                الخلفية = خـلفية(لـون("FFFFFFD0"))؛
            }؛
            أضف_فروع({
                كـتابة().{
                    الطراز.الهامش = مـسافة4.نقاط(10)؛
                    النص = نـص(
                        "ننصح بتنصيب هذه اللعبة على جهازك باستخدام خيارات التنصيب في "
                        "متصفحك إن كان متصفحك يدعم تطبيقات PWA."
                    )؛
                }،
                ارتـباط_تشعبي().{
                    الكائن.زر_التنصيب = هذا؛
                    الطراز.{
                        إذا ليس أتوجد_واجهة_تنصيب_للتطبيق() الإظهار = إظـهار._مخفي_؛
                        زخرفة_النص = زخـرفة_نص._بلا_؛
                    }؛
                    العنوان = نـص("#")؛
                    حدد_الفرع(كـتابة().{
                        النص = نـص("نصّب اللعبة")؛
                        الطراز.{
                            الهامش = مـسافة4.نقاط(20)؛
                            لون_الخط = لـون(0، 100، 200)؛
                        }؛
                    })؛
                    عند_الضغط.المبدئي_مكبوح = 1؛
                    عند_الضغط.اربط(مغلفة (سند[ودجـة]، سند[صـحيح]) {
                        // تتمة: أخف الزر وأظهر إشعار الانشغال.
                        إذا ليس اعرض_واجهة_تنصيب_التطبيق() {
                            // تتمة: اعرض إشعار عدم تطابق المتصفح.
                        }
                    })؛
                }
            })؛
        }؛
    }

    عملية هذا.أنشئ_زر_البدء(عرض: صـحيح): سـندنا[صـندوق] {
        عرف الكائن: سند[هذا_الصنف](هذا)؛
        أرجع صـندوق().{
            الطراز.{
                الإظهار = إظـهار._مرن_؛
                النسق = نـسق._عمود_؛
                المحاذاة = مـحاذاة._وسط_؛
                ملء_السطر = مـلء_سطر._مسافة_بينية_؛
                العرض = مـسافة.مئوي(عرض) - مـسافة.نقاط(40)؛
                نصف_قطر_الإطار = مـسافة4.نقاط(20)؛
                الهامش = مـسافة4.نقاط(10)؛
                الحشوة = مـسافة4.نقاط(10)؛
                الخلفية = خـلفية(لـون("FFFFFFD0"))؛
            }؛
            أضف_فروع({
                كـتابة().{
                    الطراز.الهامش = مـسافة4.نقاط(10)؛
                    النص = نـص(
                        "يمكنك أيضًا تشغيل اللعبة في المتصفح مباشرة. اللعبة مصصمة "
                        "لوضعية الشاشة الأفقية."
                    )؛
                }،
                ارتـباط_تشعبي().{
                    الطراز.زخرفة_النص = زخـرفة_نص._بلا_؛
                    العنوان = نـص("#")؛
                    حدد_الفرع(كـتابة().{
                        النص = نـص("ابدأ اللعبة")؛
                        الطراز.{
                            الهامش = مـسافة4.نقاط(20)؛
                            لون_الخط = لـون(0، 100، 200)؛
                        }؛
                    })؛
                    عند_الضغط.المبدئي_مكبوح = 1؛
                    عند_الضغط.اربط(مغلفة (سند[ودجـة]، سند[صـحيح]) {
                        // سننتظر تحميل الموارد أولا.
                        إذا تحميل_الموارد.الحالة != مـؤجلات.حـالة._مقرر_ ارجع؛
                        // سنشغل صوتا فارغًا لتمكين الأصوات على نظام iOS.
                        صوت_فارغ.شغل(0)؛
                        الكائن.مؤجلة.قرر(0)؛
                    })؛
                }
            })؛
        }؛
    }

    عملية هذا.أنشئ_زر_توجيه(عرض: صـحيح، نص_الشرح: نـص، نص_الزر: نـص، الرابط: نـص): سـندنا[صـندوق] {
        أرجع صـندوق().{
            الطراز.{
                الإظهار = إظـهار._مرن_؛
                النسق = نـسق._عمود_؛
                المحاذاة = مـحاذاة._وسط_؛
                ملء_السطر = مـلء_سطر._مسافة_بينية_؛
                العرض = مـسافة.مئوي(عرض) - مـسافة.نقاط(40)؛
                نصف_قطر_الإطار = مـسافة4.نقاط(20)؛
                الهامش = مـسافة4.نقاط(10)؛
                الحشوة = مـسافة4.نقاط(10)؛
                الخلفية = خـلفية(لـون("FFF1D6DE"))؛
            }؛
            أضف_فروع({
                كـتابة().{
                    الطراز.الهامش = مـسافة4.نقاط(10)؛
                    النص = نص_الشرح
                }،
                ارتـباط_تشعبي().{
                    الطراز.زخرفة_النص = زخـرفة_نص._بلا_؛
                    العنوان = الرابط؛
                    حدد_الفرع(كـتابة().{
                        النص = نص_الزر؛
                        الطراز.{
                            الهامش = مـسافة4.نقاط(20)؛
                            لون_الخط = لـون(0، 100، 200)؛
                        }؛
                    })؛
                    عند_الضغط.المبدئي_مكبوح = 1؛
                    عند_الضغط.اربط(مغلفة (سند[ودجـة]، سند[صـحيح]) {
                        نـافذة.النموذج.ادفع_مسارا(الرابط)؛
                    })؛
                }
            })؛
        }؛
    }

    عملية هذا.قد_تغير_العرض(عرض: صـحيح) {
        إذا عرض == 0 ارجع؛
        عرف العرض_بالنقاط: صـحيح = عرض ÷ 1.3333؛
        عرف شاشة_عريضة: ثـنائي = العرض_بالنقاط > 550؛
        إذا هذا.جديد أو شاشة_عريضة != هذا.شاشة_عريضة {
            إذا شاشة_عريضة هذا.أنشئ_المشهد_لشاشة_عريضة()
            وإلا هذا.أنشئ_المشهد_لشاشة_رفيعة()؛
            هذا.جديد = 0؛
        }
        هذا.شاشة_عريضة = شاشة_عريضة؛
    }

    عملية هذا.أظهر_زر_التنصيب() {
        هذا.زر_التنصيب.الطراز.الإظهار = إظـهار._كتلة_؛
    }

    عملية هذا_الصنف (): سـندنا[الـصفحة_الرئيسية] {
        أرجع سـندنا[الـصفحة_الرئيسية]().{ احجز()~هيئ() }؛
    }
}
