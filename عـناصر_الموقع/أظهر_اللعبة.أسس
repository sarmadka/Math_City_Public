دالة أظهر_اللعبة(تجاوز_المقدمة: ثـنائي) {
    هل_نحتاج_لوحة_المفاتيح = 1؛
    نـافذة.النموذج.حجم(_عرض_النافذة_، _طول_النافذة_)؛
    عرف ملء_الشاشة: ثـنائي = 0؛
    عرف اللمسة_الحالية: نـص؛
    المشهد_الرئيسي.{
        الطراز.{
            الحشوة = مـسافة4.نقاط(0)؛
            الهامش = مـسافة4.نقاط(0)؛
            العرض = مـسافة.مئوي(100)؛
            الطول = مـسافة.مئوي(100)؛
            الخلفية = خـلفية(لـون(0، 0، 0))؛
        }؛
        أزل_كل_الفروع()؛
        أضف_فروع({
            صـندوق().{
                الطراز.{
                    الإظهار = إظـهار._مرن_؛
                    النسق = نـسق._عمود_؛
                    المحاذاة = مـحاذاة._وسط_؛
                    ملء_السطر = مـلء_سطر._مسافة_محيطية_؛
                    الاتجاه = اتـجاه._من_اليمين_؛
                    العرض = مـسافة.مئوي(100)؛
                    الطول = مـسافة.مئوي(100)؛
                }؛
                أضف_فروع({
                    مـرسم().{
                        مرسم_العرض = هذا؛
                        عرض_الصورة = مـسافة.بكسلات(_عرض_النافذة_)؛
                        طول_الصورة = مـسافة.بكسلات(_طول_النافذة_)؛
                        الطراز.{
                            العرض = مـسافة.مئوي(100)؛
                            الطول = مـسافة.مئوي(100)؛
                            سمك_الإطار = مـسافة4.نقاط(2)؛
                            لون_الإطار = لـون(0, 0, 0)؛
                            الخلفية = خـلفية(لـون(0, 0, 0))؛
                            الاتجاه = اتـجاه._من_اليمين_؛
                        }؛
                        عرف مستطيل: سـندنا[مـستطيل] = سـندنا[مـستطيل].أنشئ().{ س = 0؛ ص = 0؛ عرض = 1؛ طول = 1؛ }؛
                        عند_تحريك_المؤشر.اربط(مغلفة (ودجة: سند[ودجـة]، حمولة: سند[حـمولة_تحريك_المؤشر]) {
                            تحكم.س = حمولة.موقع_س * _عرض_النافذة_ ÷ مستطيل.عرض؛
                            تحكم.ص = حمولة.موقع_ص * _طول_النافذة_ ÷ مستطيل.طول؛
                        })؛
                        عند_بدء_النقرة.اربط(مغلفة (ودجة: سند[ودجـة]، حمولة: سند[حـمولة_زر_المؤشر]) {
                            تحكم.س = حمولة.موقع_س * _عرض_النافذة_ ÷ مستطيل.عرض؛
                            تحكم.ص = حمولة.موقع_ص * _طول_النافذة_ ÷ مستطيل.طول؛
                            إذا حمولة.الزر == 0 {
                                تحكم.نقرة = 1؛
                                تحكم.نقرة_للتو = 1؛
                                هل_نحتاج_لوحة_المفاتيح = 1؛
                                إذا ليس تحكم.عند_النقر.أهو_عدم() تحكم.عند_النقر()؛
                                إذا ليس ملء_الشاشة {
                                    المكداس.التمس_ملء_الشاشة()؛
                                }
                            }
                        })؛
                        عند_انتهاء_النقرة.اربط(مغلفة (ودجة: سند[ودجـة]، حمولة: سند[حـمولة_زر_المؤشر]) {
                            تحكم.س = حمولة.موقع_س * _عرض_النافذة_ ÷ مستطيل.عرض؛
                            تحكم.ص = حمولة.موقع_ص * _طول_النافذة_ ÷ مستطيل.طول؛
                            إذا حمولة.الزر == 0 تحكم.نقرة = 0؛
                        })؛
                        عند_تحريك_اللمس.المبدئي_مكبوح = 1؛
                        عند_تحريك_اللمس.اربط(مغلفة (اللمسة_الحالية: كسند)&(ودجة: سند[ودجـة]، حمولة: سند[مـصفوفة[حـمولة_لمس]]) {
                            عرف ع: صـحيح؛
                            لكل ع = 0، ع < حمولة.هات_الطول()، ++ع {
                                إذا حمولة(ع).المعرف != اللمسة_الحالية أكمل؛
                                تحكم.س = (حمولة(ع).مشهد_س - مستطيل.س) * _عرض_النافذة_ ÷ مستطيل.عرض؛
                                تحكم.ص = (حمولة(ع).مشهد_ص - مستطيل.ص) * _طول_النافذة_ ÷ مستطيل.طول؛
                                اقطع؛
                            }
                        })؛
                        عند_بدء_اللمس.المبدئي_مكبوح = 1؛
                        عند_بدء_اللمس.اربط(مغلفة (اللمسة_الحالية: كسند)&(ودجة: سند[ودجـة]، حمولة: سند[مـصفوفة[حـمولة_لمس]]) {
                            عرف ع: صـحيح؛
                            لكل ع = 0، ع < حمولة.هات_الطول()، ++ع {
                                إذا ليس حمولة(ع).مغيرة أكمل؛
                                اللمسة_الحالية = حمولة(ع).المعرف؛
                                تحكم.س = (حمولة(ع).مشهد_س - مستطيل.س) * _عرض_النافذة_ ÷ مستطيل.عرض؛
                                تحكم.ص = (حمولة(ع).مشهد_ص - مستطيل.ص) * _طول_النافذة_ ÷ مستطيل.طول؛
                                تحكم.نقرة = 1؛
                                تحكم.نقرة_للتو = 1؛
                                هل_نحتاج_لوحة_المفاتيح = 1؛
                                إذا ليس تحكم.عند_النقر.أهو_عدم() تحكم.عند_النقر()؛
                                إذا ليس ملء_الشاشة {
                                    المكداس.التمس_ملء_الشاشة()؛
                                }
                                اقطع؛
                            }
                        })؛
                        عند_انتهاء_اللمس.المبدئي_مكبوح = 1؛
                        عند_انتهاء_اللمس.اربط(مغلفة (اللمسة_الحالية: كسند)&(ودجة: سند[ودجـة]، حمولة: سند[مـصفوفة[حـمولة_لمس]]) {
                            عرف ع: صـحيح؛
                            لكل ع = 0، ع < حمولة.هات_الطول()، ++ع {
                                إذا حمولة(ع).المعرف == اللمسة_الحالية ارجع؛
                            }
                            تحكم.نقرة = 0؛
                        })؛
                        عند_تغير_الأبعاد.اربط(مغلفة (ودجة: سند[ودجـة]، حمولة: سند[صحيح]) {
                            مستطيل = هذا.هات_المستطيل_المحيط()؛
                        })؛
                    }
                })؛
                عند_تغير_الأبعاد.اربط(مغلفة (ودجة: سند[ودجـة]، سند[صـحيح]) {
                    عرف أبعاد: أبـعاد = ودجة.هات_الأبعاد()؛
                    عرف عرض: صـحيح = أبعاد.عرض؛
                    عرف طول: صـحيح = أبعاد.عرض~مثل[عـائم] * _طول_النافذة_ ÷ _عرض_النافذة_؛
                    إذا طول > أبعاد.طول {
                        طول = أبعاد.طول؛
                        عرض = أبعاد.طول~مثل[عـائم] * _عرض_النافذة_ ÷ _طول_النافذة_؛
                    }
                    مرسم_العرض.الطراز.{
                        العرض = مـسافة.بكسلات(عرض)؛
                        الطول = مـسافة.بكسلات(طول)؛
                    }؛
                })؛
            }؛
        })؛
    }؛

    // عرف المؤشر_محتكر: ثنائي = 0؛

    نـافذة.النموذج.{
        المفاتيح_المكبوتة = "ArrowUp,ArrowDown,ArrowLeft,ArrowRight,Space"؛
        عند_بدء_الكبسة.اربط(مغلفة (ملء_الشاشة: كسند)&(نافذة: سند[نـافذة]، حمولة: سند[نـص]) {
            هل_نحتاج_لوحة_المفاتيح = 0؛
            تحكم.عند_بدء_الكبسة(حمولة)؛
            إذا حمولة == "Enter" {
                إذا ملء_الشاشة ألغ_ملء_الشاشة()
                وإلا المكداس.التمس_ملء_الشاشة()؛
            }
        })؛
        عند_انتهاء_الكبسة.اربط(مغلفة (نافذة: سند[نـافذة]، حمولة: سند[نـص]) {
            تحكم.عند_انتهاء_الكبسة(حمولة)؛
        })؛
        // عند_تغير_احتكار_المؤشر.اربط(مغلفة (المؤشر_محتكر: كسند)&(نافذة: سند[نـافذة]، حمولة: سند[ثـنائي]) {
        //     المؤشر_محتكر = حمولة؛
        // })؛
        عند_تغير_ملء_الشاشة.اربط(مغلفة (ملء_الشاشة: كسند)&(نافذة: سند[نـافذة]، حمولة: سند[ثـنائي]) {
            ملء_الشاشة = حمولة؛
            // إذا حمولة مرسم_العرض.التمس_احتكار_المؤشر()
            // وإلا ألغ_احتكار_المؤشر()؛
        })؛
        عند_تغير_المرئية.اربط(مغلفة (ملء_الشاشة: كسند)&(نافذة: سند[نـافذة]، حمولة: سند[صـحيح]) {
            إذا نافذة.مرئية {
                التطبيق_في_الخلفية = 0؛
                استأنف_سياق_الصوت()؛
                صـوت.استأنف_جميع_الأصوات()؛
                التمس_يقظة_الشاشة()؛
            } وإلا {
                صـوت.ألبث_جميع_الأصوات()؛
                التطبيق_في_الخلفية = 1؛
            }
        })؛
    }؛

    المكداس.التمس_ملء_الشاشة()؛
    التمس_يقظة_الشاشة()؛
    مرسم_النقوش = سـندنا[مـورد_مرسم]().{ احجز()~هيئ(8، 8) }؛
    المرسم~عطل_التتبع = مرسم_العرض.رسم؛

    // البداية
    سيف(تجاوز_المقدمة)؛
}
